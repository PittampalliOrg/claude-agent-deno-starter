# Use Nix flake for development environment
use flake

# 1Password CLI integration for API key
# Using op:// reference format
if command -v op &> /dev/null; then
  export ANTHROPIC_API_KEY=$(op read "op://CLI/ANTHROPIC_API_KEY/credential")

  if [ $? -eq 0 ] && [ -n "$ANTHROPIC_API_KEY" ]; then
    # Successfully retrieved from 1Password
    :
  else
    # Fall back to .envrc.local if 1Password fails
    if [ -f .envrc.local ]; then
      source_env .envrc.local
    fi
  fi
else
  # 1Password CLI not available, use .envrc.local
  if [ -f .envrc.local ]; then
    source_env .envrc.local
  fi
fi

# Set up npm global directory for Claude Code CLI
export NPM_CONFIG_PREFIX=$PWD/.npm-global
export PATH=$PWD/.npm-global/bin:$PATH

# Optional: Set custom Claude Code data directory
# export CLAUDE_CODE_DATA_DIR=$PWD/.claude-data
