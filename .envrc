# Use Nix flake for development environment
use flake

# Load .envrc.local first for service account token and other secrets
# This file should contain: export OP_SERVICE_ACCOUNT_TOKEN=your_token_here
if [ -f .envrc.local ]; then
  source_env .envrc.local
fi

# 1Password Service Account Token for automated access
# If OP_SERVICE_ACCOUNT_TOKEN is set (from .envrc.local), use it to get API key
if command -v op &> /dev/null && [ -n "$OP_SERVICE_ACCOUNT_TOKEN" ]; then
  # Retrieve the Anthropic API key from 1Password using the service account token
  export ANTHROPIC_API_KEY=$(op read "op://CLI/ANTHROPIC_API_KEY/credential" 2>/dev/null || echo "")

  if [ -z "$ANTHROPIC_API_KEY" ]; then
    echo "⚠️  Failed to retrieve ANTHROPIC_API_KEY from 1Password" >&2
  fi
fi

# If still no API key, warn the user
if [ -z "$ANTHROPIC_API_KEY" ]; then
  echo "⚠️  ANTHROPIC_API_KEY not set. See docs/1PASSWORD.md for setup instructions" >&2
fi

# Set up npm global directory for Claude Code CLI
export NPM_CONFIG_PREFIX=$PWD/.npm-global
export PATH=$PWD/.npm-global/bin:$PATH

# Optional: Set custom Claude Code data directory
# export CLAUDE_CODE_DATA_DIR=$PWD/.claude-data
